# 認証サービス API 詳細仕様書

このドキュメントでは、認証サービス（Auth Service）の API 仕様について詳細に説明します。

## 目次

1. [API 概要](#api概要)
2. [認証フロー](#認証フロー)
3. [エンドポイント詳細](#エンドポイント詳細)
   - [ユーザー登録](#ユーザー登録)
   - [管理者によるユーザー登録](#管理者によるユーザー登録)
   - [ログイン](#ログイン)
   - [トークン更新](#トークン更新)
   - [ログアウト](#ログアウト)
   - [全ユーザー取得](#全ユーザー取得)
   - [ユーザー情報更新](#ユーザー情報更新)
   - [ユーザー削除](#ユーザー削除)
4. [データモデル](#データモデル)
5. [エラーレスポンス](#エラーレスポンス)
6. [セキュリティ仕様](#セキュリティ仕様)

## API 概要

認証サービスは、RESTful API を提供し、ユーザー認証と管理機能を実装しています。すべての API エンドポイントは `/api/v1` をベース URL としています。

主な機能：

- ユーザー登録と管理
- JWT 認証（アクセストークンとリフレッシュトークン）
- ログイン/ログアウト処理
- ユーザー情報の更新と削除

## 認証フロー

### 全体フロー

```
┌─────────┐          ┌───────────────┐          ┌───────────┐          ┌─────────┐
│  Client  │          │  AuthService  │          │ PostgreSQL │          │  Redis  │
└────┬────┘          └───────┬───────┘          └─────┬─────┘          └────┬────┘
     │                        │                        │                     │
     │  1. ユーザー登録       │                        │                     │
     │ ──────────────────────>│                        │                     │
     │                        │                        │                     │
     │                        │  ユーザー情報を保存    │                     │
     │                        │ ──────────────────────>│                     │
     │                        │                        │                     │
     │                        │<───────────────────────│                     │
     │                        │                        │                     │
     │<───────────────────────│                        │                     │
     │                        │                        │                     │
     │  2. ログイン           │                        │                     │
     │ ──────────────────────>│                        │                     │
     │                        │                        │                     │
     │                        │  ユーザー認証          │                     │
     │                        │ ──────────────────────>│                     │
     │                        │                        │                     │
     │                        │<───────────────────────│                     │
     │                        │                        │                     │
     │                        │  リフレッシュトークン保存                    │
     │                        │ ─────────────────────────────────────────────>│
     │                        │                        │                     │
     │                        │<────────────────────────────────────────────│
     │                        │                        │                     │
     │<───────────────────────│                        │                     │
     │                        │                        │                     │
     │  3. トークンリフレッシュ│                        │                     │
     │ ──────────────────────>│                        │                     │
     │                        │                        │                     │
     │                        │  リフレッシュトークン検証                    │
     │                        │ ─────────────────────────────────────────────>│
     │                        │                        │                     │
     │                        │<────────────────────────────────────────────│
     │                        │                        │                     │
     │                        │  古いトークン無効化    │                     │
     │                        │ ─────────────────────────────────────────────>│
     │                        │                        │                     │
     │                        │<────────────────────────────────────────────│
     │                        │                        │                     │
     │                        │  新しいトークン保存    │                     │
     │                        │ ─────────────────────────────────────────────>│
     │                        │                        │                     │
     │                        │<────────────────────────────────────────────│
     │                        │                        │                     │
     │<───────────────────────│                        │                     │
     │                        │                        │                     │
     │  4. ログアウト         │                        │                     │
     │ ──────────────────────>│                        │                     │
     │                        │                        │                     │
     │                        │  リフレッシュトークン無効化                  │
     │                        │ ─────────────────────────────────────────────>│
     │                        │                        │                     │
     │                        │<────────────────────────────────────────────│
     │                        │                        │                     │
     │<───────────────────────│                        │                     │
     │                        │                        │                     │
```

### ユーザー登録フロー

```
┌─────────┐          ┌───────────┐          ┌───────────┐          ┌───────────┐          ┌───────────┐
│  Client  │          │  FastAPI  │          │ AuthRouter │          │ UserCRUD  │          │ PostgreSQL │
└────┬────┘          └─────┬─────┘          └─────┬─────┘          └─────┬─────┘          └─────┬─────┘
     │                      │                      │                      │                      │
     │  POST /register      │                      │                      │                      │
     │ ─────────────────────>                      │                      │                      │
     │                      │                      │                      │                      │
     │                      │  register_user()     │                      │                      │
     │                      │ ─────────────────────>                      │                      │
     │                      │                      │                      │                      │
     │                      │                      │  get_by_username()   │                      │
     │                      │                      │ ─────────────────────>                      │
     │                      │                      │                      │                      │
     │                      │                      │                      │  SELECT              │
     │                      │                      │                      │ ─────────────────────>
     │                      │                      │                      │                      │
     │                      │                      │                      │<─────────────────────│
     │                      │                      │                      │                      │
     │                      │                      │<─────────────────────│                      │
     │                      │                      │                      │                      │
     │                      │                      │  create()            │                      │
     │                      │                      │ ─────────────────────>                      │
     │                      │                      │                      │                      │
     │                      │                      │                      │  INSERT              │
     │                      │                      │                      │ ─────────────────────>
     │                      │                      │                      │                      │
     │                      │                      │                      │<─────────────────────│
     │                      │                      │                      │                      │
     │                      │                      │<─────────────────────│                      │
     │                      │                      │                      │                      │
     │                      │<─────────────────────│                      │                      │
     │                      │                      │                      │                      │
     │<─────────────────────│                      │                      │                      │
     │                      │                      │                      │                      │
```

### ログインフロー

```
┌─────────┐     ┌───────────┐     ┌───────────┐     ┌───────────┐     ┌───────────┐     ┌───────────┐     ┌─────────┐
│  Client  │     │  FastAPI  │     │ AuthRouter │     │ UserCRUD  │     │ Security  │     │ PostgreSQL │     │  Redis  │
└────┬────┘     └─────┬─────┘     └─────┬─────┘     └─────┬─────┘     └─────┬─────┘     └─────┬─────┘     └────┬────┘
     │                │                 │                 │                 │                 │                │
     │ POST /login    │                 │                 │                 │                 │                │
     │ ───────────────>                 │                 │                 │                 │                │
     │                │                 │                 │                 │                 │                │
     │                │ login()         │                 │                 │                 │                │
     │                │ ────────────────>                 │                 │                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │ get_by_username()                 │                 │                │
     │                │                 │ ────────────────>                 │                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │                 │ SELECT          │                 │                │
     │                │                 │                 │ ────────────────────────────────>                 │
     │                │                 │                 │                 │                 │                │
     │                │                 │                 │<────────────────────────────────                 │
     │                │                 │                 │                 │                 │                │
     │                │                 │<────────────────│                 │                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │ verify_password()                 │                 │                │
     │                │                 │ ────────────────────────────────>                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │<────────────────────────────────                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │ create_access_token()             │                 │                │
     │                │                 │ ────────────────────────────────>                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │<────────────────────────────────                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │ create_refresh_token()            │                 │                │
     │                │                 │ ────────────────────────────────>                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │                 │                 │ SET             │                │
     │                │                 │                 │                 │ ───────────────────────────────>
     │                │                 │                 │                 │                 │                │
     │                │                 │                 │                 │<───────────────────────────────
     │                │                 │                 │                 │                 │                │
     │                │                 │<────────────────────────────────                 │                │
     │                │                 │                 │                 │                 │                │
     │                │<────────────────│                 │                 │                 │                │
     │                │                 │                 │                 │                 │                │
     │<───────────────│                 │                 │                 │                 │                │
     │                │                 │                 │                 │                 │                │
```

### トークン更新フロー

```
┌─────────┐     ┌───────────┐     ┌───────────┐     ┌───────────┐     ┌───────────┐     ┌───────────┐     ┌─────────┐
│  Client  │     │  FastAPI  │     │ AuthRouter │     │  APIDeps  │     │ Security  │     │ PostgreSQL │     │  Redis  │
└────┬────┘     └─────┬─────┘     └─────┬─────┘     └─────┬─────┘     └─────┬─────┘     └─────┬─────┘     └────┬────┘
     │                │                 │                 │                 │                 │                │
     │ POST /refresh  │                 │                 │                 │                 │                │
     │ ───────────────>                 │                 │                 │                 │                │
     │                │                 │                 │                 │                 │                │
     │                │ refresh_token() │                 │                 │                 │                │
     │                │ ────────────────>                 │                 │                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │ validate_refresh_token()          │                 │                │
     │                │                 │ ────────────────>                 │                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │                 │ verify_refresh_token()            │                │
     │                │                 │                 │ ────────────────>                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │                 │                 │ GET             │                │
     │                │                 │                 │                 │ ───────────────────────────────>
     │                │                 │                 │                 │                 │                │
     │                │                 │                 │                 │<───────────────────────────────
     │                │                 │                 │                 │                 │                │
     │                │                 │                 │<────────────────│                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │<────────────────│                 │                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │ revoke_refresh_token()            │                 │                │
     │                │                 │ ────────────────────────────────>                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │                 │                 │ DELETE          │                │
     │                │                 │                 │                 │ ───────────────────────────────>
     │                │                 │                 │                 │                 │                │
     │                │                 │                 │                 │<───────────────────────────────
     │                │                 │                 │                 │                 │                │
     │                │                 │<────────────────────────────────                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │ create_access_token()             │                 │                │
     │                │                 │ ────────────────────────────────>                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │<────────────────────────────────                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │ create_refresh_token()            │                 │                │
     │                │                 │ ────────────────────────────────>                 │                │
     │                │                 │                 │                 │                 │                │
     │                │                 │                 │                 │ SET             │                │
     │                │                 │                 │                 │ ───────────────────────────────>
     │                │                 │                 │                 │                 │                │
     │                │                 │                 │                 │<───────────────────────────────
     │                │                 │                 │                 │                 │                │
     │                │                 │<────────────────────────────────                 │                │
     │                │                 │                 │                 │                 │                │
     │                │<────────────────│                 │                 │                 │                │
     │                │                 │                 │                 │                 │                │
     │<───────────────│                 │                 │                 │                 │                │
     │                │                 │                 │                 │                 │                │
```

### ログアウトフロー

```
┌─────────┐          ┌───────────┐          ┌───────────┐          ┌───────────┐          ┌─────────┐
│  Client  │          │  FastAPI  │          │ AuthRouter │          │ Security  │          │  Redis  │
└────┬────┘          └─────┬─────┘          └─────┬─────┘          └─────┬─────┘          └────┬────┘
     │                      │                      │                      │                      │
     │  POST /logout        │                      │                      │                      │
     │ ─────────────────────>                      │                      │                      │
     │                      │                      │                      │                      │
     │                      │  logout()            │                      │                      │
     │                      │ ─────────────────────>                      │                      │
     │                      │                      │                      │                      │
     │                      │                      │  revoke_refresh_token()                     │
     │                      │                      │ ─────────────────────>                      │
     │                      │                      │                      │                      │
     │                      │                      │                      │  DEL                 │
     │                      │                      │                      │ ─────────────────────>
     │                      │                      │                      │                      │
     │                      │                      │                      │<─────────────────────│
     │                      │                      │                      │                      │
     │                      │                      │<─────────────────────│                      │
     │                      │                      │                      │                      │
     │                      │<─────────────────────│                      │                      │
     │                      │                      │                      │                      │
     │<─────────────────────│                      │                      │                      │
     │                      │                      │                      │                      │
```

## エンドポイント詳細

### ユーザー登録

**エンドポイント**: `POST /api/v1/auth/register`

**説明**: 新しい一般ユーザーを登録します。

**認証要件**: 不要

**リクエストボディ**:

```json
{
  "username": "string", // 必須、1-50文字
  "password": "string" // 必須、1-16文字
}
```

**レスポンス** (200 OK):

```json
{
  "id": "uuid",
  "username": "string",
  "is_admin": false,
  "is_active": true
}
```

**エラーレスポンス**:

- 400 Bad Request: ユーザー名が既に使用されている
  ```json
  {
    "detail": "このユーザー名は既に登録されています。"
  }
  ```
- 422 Unprocessable Entity: リクエストボディが無効
  ```json
  {
    "detail": [
      {
        "loc": ["body", "username"],
        "msg": "field required",
        "type": "value_error.missing"
      }
    ],
    "body": {}
  }
  ```
- 500 Internal Server Error: サーバーエラー
  ```json
  {
    "detail": "ユーザーの登録に失敗しました。"
  }
  ```

**cURL の例**:

```bash
curl -X POST "http://localhost:8080/api/v1/auth/register" \
     -H "Content-Type: application/json" \
     -d '{"username": "testuser", "password": "password123"}'
```

### 管理者によるユーザー登録

**エンドポイント**: `POST /api/v1/auth/admin/register`

**説明**: 管理者が新しいユーザーを登録します。管理者権限を持つユーザーを作成することも可能です。

**認証要件**: 管理者権限を持つユーザーのアクセストークン

**リクエストヘッダー**:

```
Authorization: Bearer {access_token}
```

**リクエストボディ**:

```json
{
  "username": "string",  // 必須、1-50文字
  "password": "string",  // 必須、1-16文字
  "is_admin": boolean    // オプション、デフォルトはfalse
}
```

**レスポンス** (200 OK):

```json
{
  "id": "uuid",
  "username": "string",
  "is_admin": boolean,
  "is_active": true
}
```

**エラーレスポンス**:

- 400 Bad Request: ユーザー名が既に使用されている
  ```json
  {
    "detail": "このユーザー名は既に登録されています。"
  }
  ```
- 401 Unauthorized: 認証情報が無効
  ```json
  {
    "detail": "認証情報が無効です"
  }
  ```
- 403 Forbidden: 管理者権限がない
  ```json
  {
    "detail": "この操作には管理者権限が必要です"
  }
  ```
- 422 Unprocessable Entity: リクエストボディが無効
- 500 Internal Server Error: サーバーエラー

**cURL の例**:

```bash
curl -X POST "http://localhost:8080/api/v1/auth/admin/register" \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer {access_token}" \
     -d '{"username": "adminuser", "password": "adminpass", "is_admin": true}'
```

### ログイン

**エンドポイント**: `POST /api/v1/auth/login`

**説明**: ユーザー認証を行い、アクセストークンとリフレッシュトークンを発行します。

**認証要件**: 不要

**リクエストボディ** (application/x-www-form-urlencoded):

```
username: string  // 必須
password: string  // 必須
```

**レスポンス** (200 OK):

```json
{
  "access_token": "string",
  "refresh_token": "string",
  "token_type": "bearer"
}
```

**エラーレスポンス**:

- 401 Unauthorized: ユーザー名またはパスワードが正しくない
  ```json
  {
    "detail": "ユーザー名またはパスワードが正しくありません"
  }
  ```
- 422 Unprocessable Entity: リクエストボディが無効

**cURL の例**:

```bash
curl -X POST "http://localhost:8080/api/v1/auth/login" \
     -H "Content-Type: application/x-www-form-urlencoded" \
     -d "username=testuser&password=password123"
```

### トークン更新

**エンドポイント**: `POST /api/v1/auth/refresh`

**説明**: リフレッシュトークンを使用して新しいアクセストークンとリフレッシュトークンを発行します。

**認証要件**: 不要

**リクエストボディ**:

```json
{
  "refresh_token": "string" // 必須
}
```

**レスポンス** (200 OK):

```json
{
  "access_token": "string",
  "refresh_token": "string",
  "token_type": "bearer"
}
```

**エラーレスポンス**:

- 401 Unauthorized: リフレッシュトークンが無効
  ```json
  {
    "detail": "リフレッシュトークンが無効です"
  }
  ```
- 422 Unprocessable Entity: リクエストボディが無効

**cURL の例**:

```bash
curl -X POST "http://localhost:8080/api/v1/auth/refresh" \
     -H "Content-Type: application/json" \
     -d '{"refresh_token": "your-refresh-token"}'
```

### ログアウト

**エンドポイント**: `POST /api/v1/auth/logout`

**説明**: リフレッシュトークンを無効化してログアウトします。

**認証要件**: 不要

**リクエストボディ**:

```json
{
  "refresh_token": "string" // 必須
}
```

**レスポンス** (200 OK):

```json
{
  "detail": "ログアウトしました"
}
```

**エラーレスポンス**:

- 400 Bad Request: 無効なトークン
  ```json
  {
    "detail": "無効なトークンです"
  }
  ```
- 422 Unprocessable Entity: リクエストボディが無効

**cURL の例**:

```bash
curl -X POST "http://localhost:8080/api/v1/auth/logout" \
     -H "Content-Type: application/json" \
     -d '{"refresh_token": "your-refresh-token"}'
```

### 全ユーザー取得

**エンドポイント**: `GET /api/v1/auth/users`

**説明**: 全てのユーザー情報を取得します。

**認証要件**: 管理者権限を持つユーザーのアクセストークン

**リクエストヘッダー**:

```
Authorization: Bearer {access_token}
```

**レスポンス** (200 OK):

```json
[
  {
    "id": "uuid",
    "username": "string",
    "is_admin": boolean,
    "is_active": boolean
  }
]
```

**エラーレスポンス**:

- 401 Unauthorized: 認証情報が無効
  ```json
  {
    "detail": "認証情報が無効です"
  }
  ```
- 403 Forbidden: 管理者権限がない
  ```json
  {
    "detail": "この操作には管理者権限が必要です"
  }
  ```

**cURL の例**:

```bash
curl -X GET "http://localhost:8080/api/v1/auth/users" \
     -H "Authorization: Bearer {access_token}"
```

### ユーザー情報更新

**エンドポイント**: `PUT /api/v1/auth/users/{user_id}`

**説明**: 指定されたユーザーの情報を更新します。自分自身または管理者のみが更新可能です。管理者権限の変更は管理者のみが可能です。

**パスパラメータ**:

- `user_id`: 更新対象のユーザー ID (UUID)

**認証要件**: 有効なアクセストークン

**リクエストヘッダー**:

```
Authorization: Bearer {access_token}
```

**リクエストボディ**:

```json
{
  "username": "string",    // オプション、最大50文字
  "password": "string",    // オプション、最大16文字
  "is_active": boolean,    // オプション
  "is_admin": boolean      // オプション、管理者のみ変更可能
}
```

**レスポンス** (200 OK):

```json
{
  "id": "uuid",
  "username": "string",
  "is_admin": boolean,
  "is_active": boolean
}
```

**エラーレスポンス**:

- 400 Bad Request: ユーザー名が既に使用されている
  ```json
  {
    "detail": "ユーザー名が既に使用されています"
  }
  ```
- 401 Unauthorized: 認証情報が無効
- 403 Forbidden: 権限がない
  ```json
  {
    "detail": "他のユーザーを更新する権限がありません"
  }
  ```
  または
  ```json
  {
    "detail": "管理者権限を変更する権限がありません"
  }
  ```
- 404 Not Found: 指定されたユーザーが存在しない
  ```json
  {
    "detail": "指定されたユーザーが見つかりません"
  }
  ```
- 422 Unprocessable Entity: リクエストボディが無効
- 500 Internal Server Error: サーバーエラー

**cURL の例**:

```bash
curl -X PUT "http://localhost:8080/api/v1/auth/users/123e4567-e89b-12d3-a456-426614174000" \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer {access_token}" \
     -d '{"username": "updateduser", "is_active": true}'
```

### ユーザー削除

**エンドポイント**: `DELETE /api/v1/auth/users/{user_id}`

**説明**: 指定されたユーザーを削除します。管理者のみが実行可能で、自分自身は削除できません。

**パスパラメータ**:

- `user_id`: 削除対象のユーザー ID (UUID)

**認証要件**: 管理者権限を持つユーザーのアクセストークン

**リクエストヘッダー**:

```
Authorization: Bearer {access_token}
```

**レスポンス** (204 No Content):
コンテンツなし

**エラーレスポンス**:

- 400 Bad Request: 自分自身を削除しようとした
  ```json
  {
    "detail": "自分自身を削除することはできません"
  }
  ```
- 401 Unauthorized: 認証情報が無効
- 403 Forbidden: 管理者権限がない
- 404 Not Found: 指定されたユーザーが存在しない
- 500 Internal Server Error: サーバーエラー

**cURL の例**:

```bash
curl -X DELETE "http://localhost:8080/api/v1/auth/users/123e4567-e89b-12d3-a456-426614174000" \
     -H "Authorization: Bearer {access_token}"
```

## データモデル

### User

ユーザーモデルは以下のフィールドを持ちます：

| フィールド名    | 型      | 説明                       |
| --------------- | ------- | -------------------------- |
| id              | UUID    | ユーザーの一意識別子       |
| username        | string  | ユーザー名（一意）         |
| hashed_password | string  | ハッシュ化されたパスワード |
| is_active       | boolean | アクティブ状態             |
| is_admin        | boolean | 管理者権限                 |

### Token

トークンモデルは以下のフィールドを持ちます：

| フィールド名  | 型     | 説明                           |
| ------------- | ------ | ------------------------------ |
| access_token  | string | JWT アクセストークン           |
| refresh_token | string | リフレッシュトークン           |
| token_type    | string | トークンタイプ（常に"bearer"） |

## エラーレスポンス

認証サービスは、以下の形式でエラーレスポンスを返します：

```json
{
  "detail": "エラーメッセージ"
}
```

または、バリデーションエラーの場合：

```json
{
  "detail": [
    {
      "loc": ["body", "フィールド名"],
      "msg": "エラーメッセージ",
      "type": "エラータイプ"
    }
  ],
  "body": {}
}
```

### 共通エラーコード

| ステータスコード          | 説明                   |
| ------------------------- | ---------------------- |
| 400 Bad Request           | リクエストが不正       |
| 401 Unauthorized          | 認証情報が無効         |
| 403 Forbidden             | 権限がない             |
| 404 Not Found             | リソースが見つからない |
| 422 Unprocessable Entity  | リクエストボディが無効 |
| 500 Internal Server Error | サーバーエラー         |

## セキュリティ仕様

### 認証方式

認証サービスは、以下の認証方式を使用しています：

1. **パスワード認証**

   - bcrypt アルゴリズムを使用してパスワードをハッシュ化
   - ログイン時にパスワードを検証

2. **JWT 認証**

   - RS256 アルゴリズム（非対称暗号）を使用した JWT
   - 秘密鍵で署名、公開鍵で検証
   - ペイロードにはユーザー ID と有効期限を含む

3. **リフレッシュトークン**
   - Redis に保存されるランダムトークン
   - ユーザー ID と紐づけて保存
   - 有効期限付き

### トークンセキュリティ

- アクセストークンの有効期限は 30 分（設定可能）
- リフレッシュトークンの有効期限は 7 日（設定可能）
- ログアウト時にリフレッシュトークンを無効化
- トークン更新時に古いリフレッシュトークンを無効化

### 権限管理

- 一般ユーザーと管理者ユーザーの 2 種類の権限レベル
- 管理者のみが実行できる操作:
  - 管理者権限を持つユーザーの作成
  - 全ユーザー情報の取得
  - 他のユーザーの管理者権限の変更
  - ユーザーの削除

### セキュリティのベストプラクティス

1. **トークンの安全な管理**

   - アクセストークンはクライアント側でメモリに保存し、ローカルストレージや Cookie には保存しない
   - リフレッシュトークンは HttpOnly Cookie に保存することを推奨

2. **HTTPS 通信**

   - 本番環境では必ず HTTPS 通信を使用する
   - トークンや認証情報は暗号化された通信でのみ送信する

3. **CORS 設定**
   - 本番環境では、許可されたオリジンのみからのリクエストを受け付ける
   - 現在の設定は開発用に全てのオリジンを許可しているが、本番環境では制限する必要がある
